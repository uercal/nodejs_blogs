
doctype html
head
    meta(charset='UTF-8')
    title &#xFFFD;&#xFFFD;&#x3A2;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;
    link(rel='stylesheet', href='css/style.css')
    link(rel='stylesheet', href='css/comment.css')
//
    ������textarea�ı��򲿷�ʹ�õ�https://github.com/alexdunphy/flexText�˲���
.commentAll
    // �������� begin
    .reviewArea.clearfix
        textarea.content.comment-input(placeholder='Please enter a comment…', onkeyup='keyUP(this)')
        a.plBtn(href='javascript:;') &#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;
    // �������� end
    // �ظ����� begin
    .comment-show
        .comment-show-con.clearfix
            .comment-show-con-img.pull-left
                img(src='images/header-img-comment_03.png', alt='')
            .comment-show-con-list.pull-left.clearfix
                .pl-text.clearfix
                    a.comment-size-name(href='#') &#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD; : 
                    span.my-pl-con &nbsp;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD; &#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;!
                .date-dz
                    span.date-dz-left.pull-left.comment-time 2017-5-2 11:11:39
                    .date-dz-right.pull-right.comment-pl-block
                        a.removeBlock(href='javascript:;') &#x27E;&#xFFFD;&#xFFFD;
                        a.date-dz-pl.pl-hf.hf-con-block.pull-left(href='javascript:;') &#xFFFD;&#x638;&#xFFFD;
                        a.date-dz-z.pull-left(href='javascript:;')
                            i.date-dz-z-click-red
                            i.z-num 666
                .hf-list-con
    // �ظ����� end
script(type='text/javascript', src='js/jquery-1.12.0.min.js')
script(type='text/javascript', src='js/jquery.flexText.js')
// textarea�߶�����Ӧ
script(type='text/javascript').
    $(function () {
    $('.content').flexText();
    });
// textarea��������
script(type='text/javascript').
    function keyUP(t){
    var len = $(t).val().length;
    if(len > 139){
    $(t).val($(t).val().substring(0,140));
    }
    }
// �������۴���������
script(type='text/javascript').
    $('.commentAll').on('click','.plBtn',function(){
    var myDate = new Date();
    //��ȡ��ǰ��
    var year=myDate.getFullYear();
    //��ȡ��ǰ��
    var month=myDate.getMonth()+1;
    //��ȡ��ǰ��
    var date=myDate.getDate();
    var h=myDate.getHours();       //��ȡ��ǰСʱ��(0-23)
    var m=myDate.getMinutes();     //��ȡ��ǰ������(0-59)
    if(m<10) m = '0' + m;
    var s=myDate.getSeconds();
    if(s<10) s = '0' + s;
    var now=year+'-'+month+"-"+date+" "+h+':'+m+":"+s;
    //��ȡ��������
    var oSize = $(this).siblings('.flex-text-wrap').find('.comment-input').val();
    console.log(oSize);
    //��̬��������ģ��
    $(this).parents('.reviewArea ').siblings('.comment-show').prepend(oHtml);
    $(this).siblings('.flex-text-wrap').find('.comment-input').prop('value','').siblings('pre').find('span').text('');
    }
    });
// �����ظ���̬�����ظ���
script(type='text/javascript').
    $('.comment-show').on('click','.pl-hf',function(){
    //��ȡ�ظ��˵�����
    var fhName = $(this).parents('.date-dz-right').parents('.date-dz').siblings('.pl-text').find('.comment-size-name').html();
    //�ظ�@
    var fhN = '�ظ�@'+fhName;
    //var oInput = $(this).parents('.date-dz-right').parents('.date-dz').siblings('.hf-con');
    var fhHtml = '<div class="hf-con pull-left"> <textarea class="content comment-input hf-input" placeholder="" onkeyup="keyUP(this)"></textarea> <a href="javascript:;" class="hf-pl">����</a></div>';
    //��ʾ�ظ�
    if($(this).is('.hf-con-block')){
    $(this).parents('.date-dz-right').parents('.date-dz').append(fhHtml);
    $(this).removeClass('hf-con-block');
    $('.content').flexText();
    $(this).parents('.date-dz-right').siblings('.hf-con').find('.pre').css('padding','6px 15px');
    //console.log($(this).parents('.date-dz-right').siblings('.hf-con').find('.pre'))
    //input���Զ��۽�
    $(this).parents('.date-dz-right').siblings('.hf-con').find('.hf-input').val('').focus().val(fhN);
    }else {
    $(this).addClass('hf-con-block');
    $(this).parents('.date-dz-right').siblings('.hf-con').remove();
    }
    });
// ���ۻظ��鴴��
script(type='text/javascript').
    $('.comment-show').on('click','.hf-pl',function(){
    var oThis = $(this);
    var myDate = new Date();
    //��ȡ��ǰ��
    var year=myDate.getFullYear();
    //��ȡ��ǰ��
    var month=myDate.getMonth()+1;
    //��ȡ��ǰ��
    var date=myDate.getDate();
    var h=myDate.getHours();       //��ȡ��ǰСʱ��(0-23)
    var m=myDate.getMinutes();     //��ȡ��ǰ������(0-59)
    if(m<10) m = '0' + m;
    var s=myDate.getSeconds();
    if(s<10) s = '0' + s;
    var now=year+'-'+month+"-"+date+" "+h+':'+m+":"+s;
    //��ȡ��������
    var oHfVal = $(this).siblings('.flex-text-wrap').find('.hf-input').val();
    console.log(oHfVal)
    var oHfName = $(this).parents('.hf-con').parents('.date-dz').siblings('.pl-text').find('.comment-size-name').html();
    var oAllVal = '�ظ�@'+oHfName;
    }else {
    $.getJSON("json/pl.json",function(data){
    var oAt = '';
    var oHf = '';
    $.each(data,function(n,v){
    delete v.hfContent;
    delete v.atName;
    var arr;
    var ohfNameArr;
    if(oHfVal.indexOf("@") == -1){
    data['atName'] = '';
    data['hfContent'] = oHfVal;
    }else {
    arr = oHfVal.split(':');
    ohfNameArr = arr[0].split('@');
    data['hfContent'] = arr[1];
    data['atName'] = ohfNameArr[1];
    }
    if(data.atName == ''){
    oAt = data.hfContent;
    }else {
    oAt = '�ظ�<a href="#" class="atName">@'+data.atName+'</a> : '+data.hfContent;
    }
    oHf = data.hfName;
    });
    oThis.parents('.hf-con').parents('.comment-show-con-list').find('.hf-list-con').css('display','block').prepend(oHtml) && oThis.parents('.hf-con').siblings('.date-dz-right').find('.pl-hf').addClass('hf-con-block') && oThis.parents('.hf-con').remove();
    });
    }
    });
// ɾ�����ۿ�
script(type='text/javascript').
    $('.commentAll').on('click','.removeBlock',function(){
    var oT = $(this).parents('.date-dz-right').parents('.date-dz').parents('.all-pl-con');
    if(oT.siblings('.all-pl-con').length >= 1){
    oT.remove();
    }else {
    $(this).parents('.date-dz-right').parents('.date-dz').parents('.all-pl-con').parents('.hf-list-con').css('display','none')
    oT.remove();
    }
    $(this).parents('.date-dz-right').parents('.date-dz').parents('.comment-show-con-list').parents('.comment-show-con').remove();
    })
// ����
script(type='text/javascript').
    $('.comment-show').on('click','.date-dz-z',function(){
    var zNum = $(this).find('.z-num').html();
    if($(this).is('.date-dz-z-click')){
    zNum--;
    $(this).removeClass('date-dz-z-click red');
    $(this).find('.z-num').html(zNum);
    $(this).find('.date-dz-z-click-red').removeClass('red');
    }else {
    zNum++;
    $(this).addClass('date-dz-z-click');
    $(this).find('.z-num').html(zNum);
    $(this).find('.date-dz-z-click-red').addClass('red');
    }
    })